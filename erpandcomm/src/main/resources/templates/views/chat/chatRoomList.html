<!-- chatRoomList.html: 채팅방 목록 + 채팅창 2분할 구조 -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_basic}">
<head>
    <meta charset="UTF-8">
    <title>채팅방 목록</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" th:href="@{/assets/css/main.css}">
    <link rel="stylesheet" th:href="@{/assets/css/jm/chatRoomList.css}">
    <link rel="stylesheet" th:href="@{/assets/css/jm/chatView.css}">
    <script type="text/javascript" th:src="@{/assets/js/jquery-3.7.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/chat.delete.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/chat.js}"></script>
</head>
<body>
<div layout:fragment="content" class="page-main">
    <div class="dashboard-wrapper">
        <th:block th:replace="fragments/nav_sidebar :: sidebar" />
        <!-- 2분할: 왼쪽 채팅방 목록 / 오른쪽 채팅창 -->
        <div class="chat-split-container">
            <!-- 왼쪽: 채팅방 목록 -->
            <div class="chat-room-list-container">
                <div class="chat-room-list-header">
                    <h2>채팅방 목록</h2>
                    <a th:href="@{'/chat/createRoom'}" class="create-btn">+ 채팅방 만들기</a>
                </div>
                <table class="chat-room-table">
                    <thead>
                        <tr>
                            <th>번호</th>
                            <th>방 이름</th>
                            <th>타입</th>
                            <th>설명</th>
                            <th>인원</th>
                            <th>생성일</th>
                            <th>관리</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="room : ${chatRoomList}">
                            <td th:text="${room.room_num}"></td>
                            <td th:text="${room.room_name}"></td>
                            <td>
                                <span th:class="'room-type-badge ' + (${room.room_type == '1:1'} ? 'one-to-one' : 'group')"
                                      th:text="${room.room_type}"></span>
                            </td>
                            <td class="description-cell" 
                                th:text="${room.description != null ? (room.description.length() > 20 ? room.description.substring(0, 20) + '...' : room.description) : ''}" 
                                th:title="${room.description}"></td>
                            <td>
                                <span th:if="${room.room_type == '1:1'}">2</span>
                                <span th:if="${room.room_type == 'group'}" th:text="${room.max_members}"></span>
                            </td>
                            <td th:text="${#dates.format(room.created_at, 'yyyy-MM-dd')}"></td>
							<td>
                                <div class="action-buttons">
								<button class="enter-btn" th:data-room-id="${room.room_num}">입장</button>
								<th:block th:if="${room.role == '방장'}">
									<button class="delete-btn" th:data-room-id="${room.room_num}">삭제</button>
								</th:block>
                                </div>
							</td>
							</tr>
                        <tr th:if="${#lists.isEmpty(chatRoomList)}">
                            <td colspan="7" class="no-chat-room">참여중인 채팅이 없습니다.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- 오른쪽: 채팅창 (동적 삽입) -->
            <div class="chat-room-view-container" id="chatRoomViewContainer">
                <!-- 입장 버튼 클릭 시 AJAX로 chatView.html 내용이 이곳에 삽입됨 -->
                <div class="chat-room-placeholder">
                    <p>환영합니다!</p>
                    <p>왼쪽 목록에서 채팅방을 선택해주세요.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript">
<script th:inline="javascript">
// CSRF 토큰 설정
const token = $("meta[name='_csrf']").attr("content");
const header = $("meta[name='_csrf_header']").attr("content");

// contextPath 설정
const contextPath = /*[[@{/}]]*/ '';

// 입장 버튼 클릭 시 AJAX로 채팅방 입장
$(document).on('click', '.enter-btn', function() {
    var roomId = $(this).attr('data-room-id');
    enterChatRoom(roomId, $(this));
});

// 멤버 목록 토글 함수
function toggleMemberList() {
    var memberList = document.getElementById('memberList');
    if (memberList) {
        memberList.style.display = memberList.style.display === 'none' ? 'block' : 'none';
    }
}
</script>
</div>
</body>
</html>