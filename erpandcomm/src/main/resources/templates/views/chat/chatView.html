<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_basic}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" th:href="@{/assets/css/product.css}">
<script type="text/javascript" th:src="@{/assets/js/jquery-3.7.1.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/product.js}"></script>
</head>
<body>
<div class="page-main">
	<div class="content-main">
		<!-- chatView.html: 오른쪽 채팅방 상세 -->
		<div class="chat-view-wrapper">
		    <!-- 상단 헤더 -->
		    <div class="chat-header">
		        <div class="chat-header-title">[[${room.room_name}]]</div>
		        <div class="chat-header-actions">
		            <!-- 검색, 파일, 설정 등 아이콘 자리 (추후 구현) -->
		            <button class="chat-header-btn" title="파일첨부"><span>📎</span></button>
		            <button class="chat-header-btn" title="설정"><span>⚙️</span></button>
		        </div>
		    </div>
		    <!-- 메시지 목록 -->
		    <div class="chat-messages" id="chatMessages">
		        <!-- 예시 메시지 (실제론 AJAX로 불러옴) -->
		        <div class="chat-message-row">
		            <div class="chat-bubble">안녕하세요, 가능하실까요?</div>
		            <div class="chat-message-meta">2024-05-01 14:22</div>
		        </div>
		        <div class="chat-message-row me">
		            <div class="chat-bubble">네! 지금 바로 확인해드릴게요.</div>
		            <div class="chat-message-meta">2024-05-01 14:23</div>
		        </div>
		        <!-- ... -->
		    </div>
		    <!-- 입력창 -->
		    <form class="chat-input-area" id="chatSendForm" autocomplete="off">
		        <input type="hidden" name="room_num" value="[[${room.room_num}]]">
		        <input type="text" class="chat-input" name="message" id="chatMessageInput" placeholder="메시지를 입력하세요..." autocomplete="off" required>
		        <button type="submit" class="chat-send-btn">보내기</button>
		    </form>
		</div>
	</div>
</div>
<script>
// 메시지 전송 AJAX 예시
$('#chatSendForm').on('submit', function(e) {
    e.preventDefault();
    var msg = $('#chatMessageInput').val();
    var roomNum = $(this).find('input[name="room_num"]').val();
    if (!msg.trim()) return;
    // 실제로는 /chat/sendMessage 등으로 AJAX POST
    $.ajax({
        url: '/chat/sendMessage', // 임시 URL
        type: 'POST',
        data: { room_num: roomNum, message: msg },
        success: function(res) {
            // 성공 시 메시지 목록 갱신(여기선 임시로 바로 추가)
            $('#chatMessages').append('<div class="chat-message-row me"><div class="chat-bubble">'+msg+'</div><div class="chat-message-meta">방금</div></div>');
            $('#chatMessageInput').val('');
            $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
        }
    });
});
</script>
</body>
</html>