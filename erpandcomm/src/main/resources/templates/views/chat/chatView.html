<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_basic}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" th:href="@{/assets/css/product.css}">
<script type="text/javascript" th:src="@{/assets/js/jquery-3.7.1.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/product.js}"></script>
</head>
<body>
<div class="page-main">
	<div class="content-main">
		<!-- chatView.html: ì˜¤ë¥¸ìª½ ì±„íŒ…ë°© ìƒì„¸ -->
		<div class="chat-view-wrapper">
		    <!-- ìƒë‹¨ í—¤ë” -->
		    <div class="chat-header">
		        <div class="chat-header-title">[[${room.room_name}]]</div>
		        <div class="chat-header-actions">
		            <!-- ê²€ìƒ‰, íŒŒì¼, ì„¤ì • ë“± ì•„ì´ì½˜ ìë¦¬ (ì¶”í›„ êµ¬í˜„) -->
		            <button class="chat-header-btn" title="íŒŒì¼ì²¨ë¶€"><span>ğŸ“</span></button>
		            <button class="chat-header-btn" title="ì„¤ì •"><span>âš™ï¸</span></button>
		        </div>
		    </div>
		    <!-- ë©”ì‹œì§€ ëª©ë¡ -->
		    <div class="chat-messages" id="chatMessages">
		        <!-- ì˜ˆì‹œ ë©”ì‹œì§€ (ì‹¤ì œë¡  AJAXë¡œ ë¶ˆëŸ¬ì˜´) -->
		        <div class="chat-message-row">
		            <div class="chat-bubble">ì•ˆë…•í•˜ì„¸ìš”, ê°€ëŠ¥í•˜ì‹¤ê¹Œìš”?</div>
		            <div class="chat-message-meta">2024-05-01 14:22</div>
		        </div>
		        <div class="chat-message-row me">
		            <div class="chat-bubble">ë„¤! ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë“œë¦´ê²Œìš”.</div>
		            <div class="chat-message-meta">2024-05-01 14:23</div>
		        </div>
		        <!-- ... -->
		    </div>
		    <!-- ì…ë ¥ì°½ -->
		    <form class="chat-input-area" id="chatSendForm" autocomplete="off">
		        <input type="hidden" name="room_num" value="[[${room.room_num}]]">
		        <input type="text" class="chat-input" name="message" id="chatMessageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" required>
		        <button type="submit" class="chat-send-btn">ë³´ë‚´ê¸°</button>
		    </form>
		</div>
	</div>
</div>
<script>
// ë©”ì‹œì§€ ì „ì†¡ AJAX ì˜ˆì‹œ
$('#chatSendForm').on('submit', function(e) {
    e.preventDefault();
    var msg = $('#chatMessageInput').val();
    var roomNum = $(this).find('input[name="room_num"]').val();
    if (!msg.trim()) return;
    // ì‹¤ì œë¡œëŠ” /chat/sendMessage ë“±ìœ¼ë¡œ AJAX POST
    $.ajax({
        url: '/chat/sendMessage', // ì„ì‹œ URL
        type: 'POST',
        data: { room_num: roomNum, message: msg },
        success: function(res) {
            // ì„±ê³µ ì‹œ ë©”ì‹œì§€ ëª©ë¡ ê°±ì‹ (ì—¬ê¸°ì„  ì„ì‹œë¡œ ë°”ë¡œ ì¶”ê°€)
            $('#chatMessages').append('<div class="chat-message-row me"><div class="chat-bubble">'+msg+'</div><div class="chat-message-meta">ë°©ê¸ˆ</div></div>');
            $('#chatMessageInput').val('');
            $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
        }
    });
});
</script>
</body>
</html>