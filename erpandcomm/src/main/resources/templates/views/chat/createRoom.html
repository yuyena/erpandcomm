<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>채팅방 생성</title>
    <link rel="stylesheet" th:href="@{/assets/css/main.css}">
    <link rel="stylesheet" th:href="@{/assets/css/jm/chatRoomList.css}">
    <link rel="stylesheet" th:href="@{/assets/css/jm/chatCreateRoom.css}">
</head>
<body>
<div layout:fragment="content" class="page-main">
    <div class="dashboard-wrapper">
        <!-- 사이드바(공통) -->
        <th:block th:replace="fragments/nav_sidebar :: sidebar" />

        <div class="chat-room-list-container">
            <div class="chat-room-list-header">
                <h2>채팅방 생성</h2>
                <a th:href="@{'/chat/roomList'}" class="create-btn">← 목록으로</a>
            </div>
            <div class="top-divider"></div>
            <form th:action="@{/chat/createRoom}" method="post">
                <div class="chatroom-create-container">
                    <!-- 멤버 선택 리스트 -->
                    <div class="member-list">
                        <th:block th:each="member : ${userList}">
                            <label th:attr="data-index=${member.user_num}">
                                <input type="checkbox" name="memberNums" th:value="${member.user_num}">
                                <span th:text="${member.user_name}">이름</span>
                            </label>
                        </th:block>
                    </div>
                    <!-- 추가/제거 버튼 -->
                    <div class="button-group">
                        <button type="button" id="addBtn" class="create-btn">추가 &gt;&gt;</button>
                        <button type="button" id="removeBtn" class="create-btn">&lt;&lt; 제거</button>
                    </div>
                    <!-- 선택된 멤버 리스트 -->
                    <div class="selected-list" id="selectedList">
                        <!-- JS로 동적으로 표시 -->
                    </div>
                </div>
                <div class="save-btn-wrap">
                    <button class="save-btn" type="submit">저장</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
	document.addEventListener('DOMContentLoaded', function() {
	    const addBtn = document.getElementById('addBtn');
	    const removeBtn = document.getElementById('removeBtn');
	    const memberList = document.querySelector('.member-list');
	    const selectedList = document.getElementById('selectedList');
	
	    addBtn.onclick = function() {
	        memberList.querySelectorAll('input[type=checkbox]:checked').forEach(cb => {
	            const label = cb.parentElement;
	            selectedList.appendChild(label);
	            cb.checked = false;
	        });
	    };
	    removeBtn.onclick = function() {
	        selectedList.querySelectorAll('input[type=checkbox]:checked').forEach(cb => {
	            const label = cb.parentElement;
	            const index = parseInt(label.getAttribute('data-index'));
	            let inserted = false;
	            memberList.querySelectorAll('label').forEach((targetLabel) => {
	                const targetIndex = parseInt(targetLabel.getAttribute('data-index'));
	                if (!inserted && targetIndex > index) {
	                    memberList.insertBefore(label, targetLabel);
	                    inserted = true;
	                }
	            });
	            if (!inserted) {
	            memberList.appendChild(label);
	            }
	            cb.checked = false;
	        });
	    };
	});
</script>
</body>
</html>