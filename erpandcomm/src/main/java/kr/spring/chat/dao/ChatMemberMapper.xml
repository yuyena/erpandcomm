<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.chat.dao.ChatMemberMapper">
	
	<!-- 채팅 멤버 생성 -->
	<insert id="insertMember" parameterType="ChatMemberVO">
		INSERT INTO chat_member(
			member_num,
			room_num,
			user_num,
			role)
		VALUES(
			chat_member_seq.nextval,
			#{room_num},
			#{user_num},
			#{role})
	</insert>
	
	<!-- 채팅 멤버 조회 -->
	<select id="selectMember" parameterType="map" resultType="ChatMemberVO">
		SELECT 
			cm.member_num,
			cm.room_num,
			cm.user_num,
			cm.role,
			cm.joined_at,
			cm.is_active,
			ud.user_name
		FROM chat_member cm
		LEFT JOIN euser_detail ud ON cm.user_num = ud.user_num
		WHERE cm.room_num = #{room_num}
		AND cm.is_active = 'Y'
		ORDER BY 
			CASE WHEN cm.role = '방장' THEN 1 ELSE 2 END,
			cm.joined_at ASC
	</select>
	
</mapper>


































